

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Tutorial &mdash; Project &#34;Sailor&#34;  documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Filter Language" href="filter_language.html" />
    <link rel="prev" title="Getting started" href="introduction.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Project "Sailor"
          

          
            
            <img src="_static/sailor_logo_100x100.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reading-master-data">Reading Master Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#exploring-data">Exploring Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#read-timeseries-data">Read Timeseries Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-with-timeseries-data">Working with Timeseries Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#writing-master-data">Writing Master Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#customization">Customization</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-custom-visualizations">Building Custom Visualizations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-custom-machine-learning-models">Building Custom Machine Learning Models</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="filter_language.html">Filter Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc.html">API documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Project "Sailor"</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tutorial</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            
              <a href="https://github.com/SAP/project-sailor/blob/master/docs/tutorial.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="tutorial">
<span id="id1"></span><h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, you will learn how to use project “Sailor” to build your own algorithms and models from data stored
in your SAP backends. In particular, you will learn how to:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#how-to-configure"><span class="std std-ref">Configure project “Sailor” to access your SAP backend for asset master data and IoT data</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-read-master-data"><span class="std std-ref">Read master data from AssetCentral</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-explore-data"><span class="std std-ref">Explore and visualize master data</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-read-timeseries"><span class="std std-ref">Read timeseries data from SAP IoT</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-work-with-data"><span class="std std-ref">Use the TimeseriesDataset</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-write-master-data"><span class="std std-ref">Create and update master data</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-custom-plot"><span class="std std-ref">Build custom plots on the extracted data</span></a></p></li>
<li><p><a class="reference internal" href="#how-to-model"><span class="std std-ref">Build a machine learning model on the extracted data</span></a></p></li>
</ul>
<div class="section" id="configuration">
<span id="how-to-configure"></span><h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>Before using the functions provided as part of project “Sailor,” you will have to configure the package to work
with your SAP systems. For a detailed description of the configuration, please refer to the
<a class="reference internal" href="introduction.html"><span class="doc">Getting started guide</span></a>.</p>
<p>To start using project “Sailor,” execute the following commands to load the required packages. Since the standard data
format that is used in project “Sailor” are pandas dataframes, we also import the pandas library. You can import the required
packages like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sailor.assetcentral</span> <span class="kn">import</span> <span class="n">find_models</span><span class="p">,</span> <span class="n">find_equipment</span><span class="p">,</span> <span class="n">find_notifications</span><span class="p">,</span> <span class="n">find_systems</span>
</pre></div>
</div>
</div>
<div class="section" id="reading-master-data">
<span id="how-to-read-master-data"></span><h2>Reading Master Data<a class="headerlink" href="#reading-master-data" title="Permalink to this headline">¶</a></h2>
<p>To start the analysis, we first identify the equipment of interest. We use <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.find_equipment" title="sailor.assetcentral.equipment.find_equipment"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_equipment()</span></code></a> to search for the pieces of equipment
of interest - namely those belonging to the model <code class="docutils literal notranslate"><span class="pre">my_model_name</span></code>. The function returns a <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet" title="sailor.assetcentral.equipment.EquipmentSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">EquipmentSet</span></code></a>,
an object representing multiple pieces of equipment. The convenience function <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.as_df" title="sailor.assetcentral.utils.ResultSet.as_df"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_df()</span></code></a> returns a representation of the
<a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet" title="sailor.assetcentral.equipment.EquipmentSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">EquipmentSet</span></code></a> as <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">equipment_set</span> <span class="o">=</span> <span class="n">find_equipment</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;my_model_name&#39;</span><span class="p">)</span>
<span class="n">equipment_set</span><span class="o">.</span><span class="n">as_df</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<dl>
<dt>Filtering data</dt><dd><p>Other ways of filtering are also available, e.g., for selecting the <code class="docutils literal notranslate"><span class="pre">my_model_name</span></code> equipment in a specific location,
say PaloAlto:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">equipment_set2</span> <span class="o">=</span> <span class="n">find_equipment</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;my_model_name&#39;</span><span class="p">,</span> <span class="n">location_name</span><span class="o">=</span><span class="s1">&#39;PaloAlto&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For an overview of the syntax used for filtering, refer to the documentation of the <a class="reference internal" href="filter_language.html"><span class="doc">Filter Language</span></a>.
To get an overview of the fields that are available as filters, you can use the function <code class="xref py py-meth docutils literal notranslate"><span class="pre">get_available_properties()</span></code>.
The fields in the resulting set can be used as filters. Similar functions also exist for the other objects:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sailor.assetcentral.equipment</span> <span class="kn">import</span> <span class="n">Equipment</span>
<span class="n">Equipment</span><span class="o">.</span><span class="n">get_available_properties</span><span class="p">()</span>
</pre></div>
</div>
<p>Furthermore it is possible to filter on result sets directly. Please see <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.filter" title="sailor.assetcentral.utils.ResultSet.filter"><code class="xref py py-meth docutils literal notranslate"><span class="pre">filter()</span></code></a> for details:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">equipment_set2</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;ID_123&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd>
</dl>
<p>Other typical starting points for the analysis are models. You can search for models using
<a class="reference internal" href="apidoc/sailor.assetcentral.model.html#sailor.assetcentral.model.find_models" title="sailor.assetcentral.model.find_models"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_models()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="n">find_models</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;my_model_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can then navigate to the equipment using <code class="xref py py-meth docutils literal notranslate"><span class="pre">find_equipment()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">equi_for_model</span> <span class="o">=</span> <span class="n">models</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_equipment</span><span class="p">()</span>
</pre></div>
</div>
<p>In case of equipment that is operated together and influences each other, the set of equipment is often modeled as System.
You can also start the analysis and exploration from a (set of) system(s) using <a class="reference internal" href="apidoc/sailor.assetcentral.system.html#sailor.assetcentral.system.find_systems" title="sailor.assetcentral.system.find_systems"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_systems()</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">systems</span> <span class="o">=</span> <span class="n">find_systems</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;my_system&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can analyse events that have occured on the equipment, namely notifications that were created or workorders that were performed.
Let’s select all notifications that have been reported since August 2020. The <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet.find_notifications" title="sailor.assetcentral.equipment.EquipmentSet.find_notifications"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_notifications()</span></code></a> function can be used to search
for notifications that are linked to the equipment in the <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet" title="sailor.assetcentral.equipment.EquipmentSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">EquipmentSet</span></code></a>. The function returns a
<a class="reference internal" href="apidoc/sailor.assetcentral.notification.html#sailor.assetcentral.notification.NotificationSet" title="sailor.assetcentral.notification.NotificationSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">NotificationSet</span></code></a>,
which represents a set of notifications, similar to the <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet" title="sailor.assetcentral.equipment.EquipmentSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">EquipmentSet</span></code></a> for equipment.
Again, a <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe representation of the object can be obtained using the <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.as_df" title="sailor.assetcentral.utils.ResultSet.as_df"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_df()</span></code></a> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">notification_set</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="o">.</span><span class="n">find_notifications</span><span class="p">(</span><span class="n">extended_filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;malfunction_start_date &gt; &quot;2020-08-01&quot;&#39;</span><span class="p">])</span>
<span class="n">notification_set</span><span class="o">.</span><span class="n">as_df</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="exploring-data">
<span id="how-to-explore-data"></span><h2>Exploring Data<a class="headerlink" href="#exploring-data" title="Permalink to this headline">¶</a></h2>
<p>To facilitate exploration and use of the extracted data for exploration, visualization, and model building, the <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.as_df" title="sailor.assetcentral.utils.ResultSet.as_df"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_df()</span></code></a> function
is provided for all objects. The functions provide representations of the objects as <code class="docutils literal notranslate"><span class="pre">pandas</span></code> dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">notification_set</span><span class="o">.</span><span class="n">as_df</span><span class="p">()</span>
<span class="n">equipment_set</span><span class="o">.</span><span class="n">as_df</span><span class="p">()</span>
</pre></div>
</div>
<p>Convenience functions for typical plots are provided as part of the package. One of them is <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.plot_distribution" title="sailor.assetcentral.utils.ResultSet.plot_distribution"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot_distribution()</span></code></a> for sets.
This function can be used to plot the value distribution of a set with respect to a specific parameter. For example, let’s
plot the distribution of notifications across equipment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">notification_set</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/notification_by_equipment.png" src="_images/notification_by_equipment.png" />
<p>Along the same lines, we can plot the distribution of equipment by location.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">equipment_set</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="s1">&#39;location_name&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/equipment_by_location.png" src="_images/equipment_by_location.png" />
<p>An additional parameter can be used to determine the coloring of the bars. All fields that are returned in <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.as_df" title="sailor.assetcentral.utils.ResultSet.as_df"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_df()</span></code></a> can be
used in the grouping or coloring.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">notification_set</span><span class="o">.</span><span class="n">plot_distribution</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;confirmed_failure_mode_description&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/failure_mode_per_equipment.png" src="_images/failure_mode_per_equipment.png" />
<p>To visualize the distribution of notifications across equipment and time, the function <a class="reference internal" href="apidoc/sailor.assetcentral.notification.html#sailor.assetcentral.notification.NotificationSet.plot_overview" title="sailor.assetcentral.notification.NotificationSet.plot_overview"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot_overview()</span></code></a> may be used.
This will plot one row per piece of equipment associated with one of the notifications, the x-axis represents time. A colored block represents the time when
a notification was active on a piece of equipment, with the color representing the associated failure mode.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">notification_set</span><span class="o">.</span><span class="n">plot_overview</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/plot_overview.png" src="_images/plot_overview.png" />
<p>To understand whether there is an obvious pattern in the sensor data that is associated with a specific notification, the function
<a class="reference internal" href="apidoc/sailor.assetcentral.notification.html#sailor.assetcentral.notification.Notification.plot_context" title="sailor.assetcentral.notification.Notification.plot_context"><code class="xref py py-meth docutils literal notranslate"><span class="pre">plot_context()</span></code></a> can be used. This shows the behavior of all indicators associated with the equipment before, during, and after the
notification. This can be useful to understand whether there are obvious differences in the sensor data prior to the notifications
versus afterwards. This could help understand the issue associated with the notification.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">notification_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_context</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/context_plot.png" src="_images/context_plot.png" />
<p>Note that this filters the data for the notification locally. So if you want to plot the timeseries data for multiple notifications, it might be more efficient to create
a timeseries dataset locally as described in <a class="reference internal" href="#how-to-read-timeseries"><span class="std std-ref">Read timeseries data</span></a> and then pass it as parameter to plot context.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="o">.</span><span class="n">get_indicator_data</span><span class="p">(</span><span class="s1">&#39;2020-05-01 00:00:00+00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-03-01 00:00:00+00:00&#39;</span><span class="p">)</span>
<span class="n">notification_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot_context</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="read-timeseries-data">
<span id="how-to-read-timeseries"></span><h2>Read Timeseries Data<a class="headerlink" href="#read-timeseries-data" title="Permalink to this headline">¶</a></h2>
<p>For many use cases like anomaly detection, failure prediction, or remaining-useful-life prediction, it is useful to look at the machine’s
sensor data. Sensor data is attached to equipment via indicators. An indicator is a description of measured values.</p>
<p>To find out which indicators are defined for a piece of equipment, you can use <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.Equipment.find_equipment_indicators" title="sailor.assetcentral.equipment.Equipment.find_equipment_indicators"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_equipment_indicators()</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">indicators</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find_equipment_indicators</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;my_indicator&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For a set of equipment, you can identify the set of indicators they have in common using <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet.find_common_indicators" title="sailor.assetcentral.equipment.EquipmentSet.find_common_indicators"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_common_indicators()</span></code></a>.
This might be useful if you want to do an analysis across multiple pieces of equipment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">indicators</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="o">.</span><span class="n">find_common_indicators</span><span class="p">()</span>
</pre></div>
</div>
<p>To retrieve timeseries data from SAP IoT for the indicators of interest, you use the function <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.Equipment.get_indicator_data" title="sailor.assetcentral.equipment.Equipment.get_indicator_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_indicator_data()</span></code></a>.
This retrieves data for a single piece of equipment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_indicator_data</span><span class="p">(</span><span class="s1">&#39;2020-05-01 00:00:00+00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-03-01 00:00:00+00:00&#39;</span><span class="p">,</span> <span class="n">indicators</span><span class="p">)</span>
</pre></div>
</div>
<p>If you leave indicator set blank, then all indicators attached to the piece of equipment will be fetched.</p>
<p>For retrieving timeseries data for multiple pieces of equipment, it is more efficient to use the function <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet.get_indicator_data" title="sailor.assetcentral.equipment.EquipmentSet.get_indicator_data"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_indicator_data()</span></code></a>.
If here the indicator set is left blank, then all indicators returned by <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.EquipmentSet.find_common_indicators" title="sailor.assetcentral.equipment.EquipmentSet.find_common_indicators"><code class="xref py py-meth docutils literal notranslate"><span class="pre">find_common_indicators()</span></code></a> are queried.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="o">.</span><span class="n">get_indicator_data</span><span class="p">(</span><span class="s1">&#39;2020-10-01 00:00:00+00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2021-01-01 00:00:00+00:00&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="working-with-timeseries-data">
<span id="how-to-work-with-data"></span><h2>Working with Timeseries Data<a class="headerlink" href="#working-with-timeseries-data" title="Permalink to this headline">¶</a></h2>
<p>Timeseries data is always returned as a <a class="reference internal" href="apidoc/sailor.sap_iot.wrappers.html#sailor.sap_iot.wrappers.TimeseriesDataset" title="sailor.sap_iot.wrappers.TimeseriesDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeseriesDataset</span></code></a>.
With this object you have some options on how to work with the data contained within it.</p>
<p>You can retrieve the data as a DataFrame:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">as_df</span><span class="p">(</span><span class="n">speaking_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/data_as_df.png" src="_images/data_as_df.png" />
<p><strong>Filtering.</strong> E.g., filter the dataset based on a subset of indicators or equipments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">eq_subset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">equipment_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">location_name</span><span class="o">=</span><span class="s1">&#39;PaloAlto&#39;</span><span class="p">)</span>
<span class="n">ind_subset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">indicator_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;DS_BearingTemperature&#39;</span><span class="p">,</span> <span class="s1">&#39;DS_OilPressure&#39;</span><span class="p">])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">equipment_set</span><span class="o">=</span><span class="n">eq_subset</span><span class="p">,</span> <span class="n">indicator_set</span><span class="o">=</span><span class="n">ind_subset</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Aggregation and interpolation.</strong> If you are working with raw data and want to have your timeseries data aggregated.
Interpolation of <code class="docutils literal notranslate"><span class="pre">NaN</span></code> values is also supported:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="s1">&#39;24h&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="s1">&#39;24h&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you might be interested in plotting the resulting dataset:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/data_plot.png" src="_images/data_plot.png" />
</div>
<div class="section" id="writing-master-data">
<span id="how-to-write-master-data"></span><h2>Writing Master Data<a class="headerlink" href="#writing-master-data" title="Permalink to this headline">¶</a></h2>
<p>We also aim to provide the possibility to write data to all backend systems supported by Sailor.
In this example we show you how to create notifications in AssetCentral.</p>
<p>Notifications are usually created for some equipment.
Therefore we can use the <a class="reference internal" href="apidoc/sailor.assetcentral.equipment.html#sailor.assetcentral.equipment.Equipment.create_notification" title="sailor.assetcentral.equipment.Equipment.create_notification"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_notification()</span></code></a> function
to create a new notification for an equipment. In this example we want to create a new breakdown notification
with high priority:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">equi</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">notif</span> <span class="o">=</span> <span class="n">equi</span><span class="o">.</span><span class="n">create_notification</span><span class="p">(</span>
                <span class="n">status</span><span class="o">=</span><span class="s1">&#39;NEW&#39;</span><span class="p">,</span> <span class="n">notification_type</span><span class="o">=</span><span class="s1">&#39;M2&#39;</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span>
                <span class="n">short_description</span><span class="o">=</span><span class="s1">&#39;Valve broken&#39;</span><span class="p">,</span>
                <span class="n">start_date</span><span class="o">=</span><span class="s1">&#39;2021-07-07&#39;</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="s1">&#39;2021-07-08&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We might want to update this notification at a later time, e.g., when the maintenance crew is working on the equipment.
For this we need a notification object representing this notification. This can be the original <code class="docutils literal notranslate"><span class="pre">notif</span></code> object that
we have created, or you can obtain the object from Assetcentral again.
We can call the <a class="reference internal" href="apidoc/sailor.assetcentral.notification.html#sailor.assetcentral.notification.Notification.update" title="sailor.assetcentral.notification.Notification.update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">update()</span></code></a> method directly on the
Notification object to send our desired changes to Assetcentral:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">notif</span> <span class="o">=</span> <span class="n">find_notifications</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;previous_notification_ID&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">notif</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="s1">&#39;IPR&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see from these examples we can use the same properties as keyword arguments, that we are familiar with,
e.g., from when using the <code class="docutils literal notranslate"><span class="pre">find_*</span></code> functions.</p>
</div>
<div class="section" id="customization">
<h2>Customization<a class="headerlink" href="#customization" title="Permalink to this headline">¶</a></h2>
<div class="section" id="building-custom-visualizations">
<span id="how-to-custom-plot"></span><h3>Building Custom Visualizations<a class="headerlink" href="#building-custom-visualizations" title="Permalink to this headline">¶</a></h3>
<p>To build your custom analysis or plot, you can use the data in any <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet" title="sailor.assetcentral.utils.ResultSet"><code class="xref py py-class docutils literal notranslate"><span class="pre">ResultSet</span></code></a> and transform
it into a <cite>pandas</cite> dataframe using <a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.as_df" title="sailor.assetcentral.utils.ResultSet.as_df"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_df()</span></code></a>. The data frame can then form the
basis of your visualization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotnine</span> <span class="k">as</span> <span class="nn">p9</span>
<span class="kn">from</span> <span class="nn">sailor.utils.plot_helper</span> <span class="kn">import</span> <span class="n">_default_plot_theme</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">equipment_set</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">get_indicator_data</span><span class="p">(</span><span class="s1">&#39;2020-09-01 00:00:00+00:00&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-10-05 00:00:00+00:00&#39;</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">as_df</span><span class="p">(</span><span class="n">speaking_names</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">droplevel</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">,</span> <span class="s1">&#39;model_name&#39;</span><span class="p">,</span> <span class="s1">&#39;timestamp&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;indicator&#39;</span><span class="p">)</span>
<span class="n">p9</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">p9</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;indicator&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s1">&#39;equipment_name&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">p9</span><span class="o">.</span><span class="n">geom_violin</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span> <span class="o">+</span> <span class="n">_default_plot_theme</span><span class="p">()</span>
</pre></div>
</div>
<img alt="_images/custom_plot.png" src="_images/custom_plot.png" />
</div>
<div class="section" id="building-custom-machine-learning-models">
<span id="how-to-model"></span><h3>Building Custom Machine Learning Models<a class="headerlink" href="#building-custom-machine-learning-models" title="Permalink to this headline">¶</a></h3>
<p>Building machine learning models can be done using the same starting point as building custom visualizations, namely the method
<a class="reference internal" href="apidoc/sailor.assetcentral.utils.html#sailor.assetcentral.utils.ResultSet.as_df" title="sailor.assetcentral.utils.ResultSet.as_df"><code class="xref py py-meth docutils literal notranslate"><span class="pre">as_df()</span></code></a>.</p>
<p>This is an example of the steps necessary to train an isolation forest for detecting anomalies in the timeseries data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">IsolationForest</span>
<span class="c1"># find equipments and load data</span>
<span class="n">equi_set</span> <span class="o">=</span> <span class="n">find_equipment</span><span class="p">(</span><span class="n">model_name</span><span class="o">=</span><span class="s1">&#39;my_model_name&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">equi_set</span><span class="o">.</span><span class="n">get_indicator_data</span><span class="p">(</span><span class="s1">&#39;2020-09-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2020-10-05&#39;</span><span class="p">)</span>
<span class="c1"># train isolation forest</span>
<span class="n">iforest</span> <span class="o">=</span> <span class="n">IsolationForest</span><span class="p">()</span>
<span class="n">iforest</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">as_df</span><span class="p">())</span>
<span class="c1"># score isolation forest, and join back to index (equipment/timestamp info)</span>
<span class="n">score_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">as_df</span><span class="p">()</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">iforest</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">score_data</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">score_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;score&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="filter_language.html" class="btn btn-neutral float-right" title="Filter Language" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="introduction.html" class="btn btn-neutral float-left" title="Getting started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, SAP SE and project &#34;Sailor&#34; contributors.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #e3e3e3;
      color: #000000;
    }
    .wy-side-nav-search>a, .wy-nav-top>a {
        color: #000000;
    }
  </style>


</body>
</html>